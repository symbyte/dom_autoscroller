{"version":3,"file":"bundle.es.js","sources":["../src/index.js"],"sourcesContent":["import {boolean} from 'type-func';\nimport {\n    requestAnimationFrame as requestFrame,\n    cancelAnimationFrame as cancelFrame\n} from 'animation-frame-polyfill';\nimport {\n    hasElement,\n    addElements,\n    removeElements\n} from 'dom-set';\n\nimport {\n    createPointCB,\n    getClientRect as getRect,\n    pointInside\n} from 'dom-plane';\n\nimport mousemoveDispatcher from 'dom-mousemove-dispatcher';\n\nfunction AutoScroller(elements, options = {}){\n    const self = this;\n    let maxSpeed = 4, scrolling = false;\n\n    this.margin = options.margin || -1;\n    //this.scrolling = false;\n    this.scrollWhenOutside = options.scrollWhenOutside || false;\n\n    let point = {},\n        pointCB = createPointCB(point),\n        dispatcher = mousemoveDispatcher(),\n        down = false;\n\n    window.addEventListener('mousemove', pointCB, false);\n    window.addEventListener('touchmove', pointCB, false);\n\n    if(!isNaN(options.maxSpeed)){\n        maxSpeed = options.maxSpeed;\n    }\n\n    this.autoScroll = boolean(options.autoScroll);\n    this.syncMove = boolean(options.syncMove, false);\n\n    this.destroy = function() {\n        window.removeEventListener('mousemove', pointCB, false);\n        window.removeEventListener('touchmove', pointCB, false);\n        window.removeEventListener('mousedown', onDown, false);\n        window.removeEventListener('touchstart', onDown, false);\n        window.removeEventListener('mouseup', onUp, false);\n        window.removeEventListener('touchend', onUp, false);\n\n        window.removeEventListener('mousemove', onMove, false);\n        window.removeEventListener('touchmove', onMove, false);\n\n        window.removeEventListener('scroll', setScroll, true);\n        elements = [];\n    };\n\n    this.add = function(...element){\n        addElements(elements, ...element);\n        return this;\n    };\n\n    this.remove = function(...element){\n        return removeElements(elements, ...element);\n    };\n\n    let hasWindow = null, windowAnimationFrame;\n\n    if(Object.prototype.toString.call(elements) !== '[object Array]'){\n        elements = [elements];\n    }\n\n    (function(temp){\n        elements = [];\n        temp.forEach(function(element){\n            if(element === window){\n                hasWindow = window;\n            }else{\n                self.add(element);\n            }\n        })\n    }(elements));\n\n    Object.defineProperties(this, {\n        down: {\n            get: function(){ return down; }\n        },\n        maxSpeed: {\n            get: function(){ return maxSpeed; }\n        },\n        point: {\n            get: function(){ return point; }\n        },\n        scrolling: {\n            get: function(){ return scrolling; }\n        }\n    });\n\n    let n = 0, current = null, animationFrame;\n\n    window.addEventListener('mousedown', onDown, false);\n    window.addEventListener('touchstart', onDown, false);\n    window.addEventListener('mouseup', onUp, false);\n    window.addEventListener('touchend', onUp, false);\n\n    window.addEventListener('mousemove', onMove, false);\n    window.addEventListener('touchmove', onMove, false);\n\n    window.addEventListener('mouseleave', onMouseOut, false);\n\n    window.addEventListener('scroll', setScroll, true);\n\n    function setScroll(e){\n\n        for(let i=0; i<elements.length; i++){\n            if(elements[i] === e.target){\n                scrolling = true;\n                break;\n            }\n        }\n\n        if(scrolling){\n            requestFrame(()=>scrolling = false)\n        }\n    }\n\n    function onDown(){\n        down = true;\n    }\n\n    function onUp(){\n        down = false;\n        cancelFrame(animationFrame);\n        cancelFrame(windowAnimationFrame)\n    }\n\n    function onMouseOut(){\n        down = false;\n    }\n\n    function getTarget(target){\n        if(!target){\n            return null;\n        }\n\n        if(current === target){\n            return target;\n        }\n\n        if(hasElement(elements, target)){\n            return target;\n        }\n\n        while(target = target.parentNode){\n            if(hasElement(elements, target)){\n                return target;\n            }\n        }\n\n        return null;\n    }\n\n    function getElementUnderPoint(){\n        let underPoint = null;\n\n        for(var i=0; i<elements.length; i++){\n            if(inside(point, elements[i])){\n                underPoint = elements[i];\n            }\n        }\n\n        return underPoint;\n    }\n\n\n    function onMove(event){\n\n        if(!self.autoScroll()) return;\n\n        if(event['dispatched']){ return; }\n\n        let target = event.target, body = document.body;\n\n        if(current && !inside(point, current)){\n            if(!self.scrollWhenOutside){\n                current = null;\n            }\n        }\n\n        if(target && target.parentNode === body){\n            //The special condition to improve speed.\n            target = getElementUnderPoint();\n        }else{\n            target = getTarget(target);\n\n            if(!target){\n                target = getElementUnderPoint();\n            }\n        }\n\n\n        if(target && target !== current){\n            current = target;\n        }\n\n        if(hasWindow){\n            cancelFrame(windowAnimationFrame);\n            windowAnimationFrame = requestFrame(scrollWindow);\n        }\n\n\n        if(!current){\n            return;\n        }\n\n        cancelFrame(animationFrame);\n        animationFrame = requestFrame(scrollTick);\n    }\n\n    function scrollWindow(){\n        autoScroll(hasWindow);\n\n        cancelFrame(windowAnimationFrame);\n        windowAnimationFrame = requestFrame(scrollWindow);\n    }\n\n    function scrollTick(){\n\n        if(!current){\n            return;\n        }\n\n        autoScroll(current);\n\n        cancelFrame(animationFrame);\n        animationFrame = requestFrame(scrollTick);\n\n    }\n\n\n    function autoScroll(el){\n        let rect = getRect(el), scrollx, scrolly;\n\n        if(point.x < rect.left + self.margin){\n            scrollx = Math.floor(\n                Math.max(-1, (point.x - rect.left) / self.margin - 1) * self.maxSpeed\n            );\n        }else if(point.x > rect.right - self.margin){\n            scrollx = Math.ceil(\n                Math.min(1, (point.x - rect.right) / self.margin + 1) * self.maxSpeed\n            );\n        }else{\n            scrollx = 0;\n        }\n\n        if(point.y < rect.top + self.margin){\n            scrolly = Math.floor(\n                Math.max(-1, (point.y - rect.top) / self.margin - 1) * self.maxSpeed\n            );\n        }else if(point.y > rect.bottom - self.margin){\n            scrolly = Math.ceil(\n                Math.min(1, (point.y - rect.bottom) / self.margin + 1) * self.maxSpeed\n            );\n        }else{\n            scrolly = 0;\n        }\n\n        if(self.syncMove()){\n            /*\n            Notes about mousemove event dispatch.\n            screen(X/Y) should need to be updated.\n            Some other properties might need to be set.\n            Keep the syncMove option default false until all inconsistencies are taken care of.\n            */\n            dispatcher.dispatch(el, {\n                pageX: point.pageX + scrollx,\n                pageY: point.pageY + scrolly,\n                clientX: point.x + scrollx,\n                clientY: point.y + scrolly\n            });\n        }\n\n        setTimeout(()=>{\n\n            if(scrolly){\n                scrollY(el, scrolly);\n            }\n\n            if(scrollx){\n                scrollX(el, scrollx);\n            }\n\n        });\n    }\n\n    function scrollY(el, amount){\n        if(el === window){\n            window.scrollTo(el.pageXOffset, el.pageYOffset + amount);\n        }else{\n            el.scrollTop += amount;\n        }\n    }\n\n    function scrollX(el, amount){\n        if(el === window){\n            window.scrollTo(el.pageXOffset + amount, el.pageYOffset);\n        }else{\n            el.scrollLeft += amount;\n        }\n    }\n\n}\n\nexport default function AutoScrollerFactory(element, options){\n    return new AutoScroller(element, options);\n}\n\nfunction inside(point, el, rect){\n    if(!rect){\n        return pointInside(point, el);\n    }else{\n        return (point.y > rect.top && point.y < rect.bottom &&\n                point.x > rect.left && point.x < rect.right);\n    }\n}\n\n/*\ngit remote add origin https://github.com/hollowdoor/dom_autoscroller.git\ngit push -u origin master\n*/\n"],"names":["AutoScroller","elements","options","self","maxSpeed","scrolling","margin","scrollWhenOutside","point","pointCB","createPointCB","dispatcher","mousemoveDispatcher","down","addEventListener","isNaN","autoScroll","boolean","syncMove","destroy","removeEventListener","onDown","onUp","onMove","setScroll","add","element","remove","removeElements","hasWindow","windowAnimationFrame","Object","prototype","toString","call","temp","forEach","window","defineProperties","n","current","animationFrame","onMouseOut","e","i","length","target","getTarget","hasElement","parentNode","getElementUnderPoint","underPoint","inside","event","body","document","requestFrame","scrollWindow","scrollTick","el","rect","getRect","scrollx","scrolly","x","left","Math","floor","max","right","ceil","min","y","top","bottom","dispatch","pageX","pageY","scrollY","amount","scrollTo","pageXOffset","pageYOffset","scrollTop","scrollX","scrollLeft","AutoScrollerFactory","pointInside"],"mappings":"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"}